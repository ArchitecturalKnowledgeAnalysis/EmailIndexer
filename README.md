# EmailIndexer
Utility for generating Lucene indexed datasets for collections of emails.

## Dataset Structure

The datasets generated by this library are structured simply as a directory containing multiple files and/or subdirectories:

- The `index` directory contains all files used by Apache Lucene for creating and searching over indexes.
- The `database.mv.db` file is the self-contained H2 relational database that contains all emails and any associated tags.

This is the schema which the database uses (indexes omitted for brevity):

```sql
CREATE TABLE EMAIL (
    MESSAGE_ID VARCHAR(255) PRIMARY KEY,
    SUBJECT VARCHAR(1024),
    IN_REPLY_TO VARCHAR(255),
    SENT_FROM VARCHAR(255),
    DATE TIMESTAMP WITH TIME ZONE,
    BODY LONGTEXT,
    HIDDEN BOOL NOT NULL DEFAULT FALSE
);

/* Tags are simply defined as some short text attached to an email. */
CREATE TABLE EMAIL_TAG (
    MESSAGE_ID VARCHAR(255) NOT NULL REFERENCES EMAIL(MESSAGE_ID)
        ON UPDATE CASCADE ON DELETE CASCADE,
    TAG VARCHAR(255) NOT NULL,
    PRIMARY KEY (MESSAGE_ID, TAG)
);

/* Utility tables to record all changes made to the dataset. Each mutation should affect one or more emails. */
CREATE TABLE MUTATION (
    ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    DESCRIPTION LONGTEXT NOT NULL,
    PERFORMED_AT TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP(0),
    AFFECTED_EMAIL_COUNT BIGINT NOT NULL DEFAULT 0
);

CREATE TABLE MUTATION_EMAIL (
    MUTATION_ID BIGINT NOT NULL REFERENCES MUTATION (ID)
        ON UPDATE CASCADE ON DELETE CASCADE,
    MESSAGE_ID VARCHAR(255) NOT NULL REFERENCES EMAIL(MESSAGE_ID)
        ON UPDATE CASCADE ON DELETE CASCADE,
    PRIMARY KEY (MUTATION_ID, MESSAGE_ID)
);
```